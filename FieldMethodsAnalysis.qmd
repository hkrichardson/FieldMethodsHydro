---
title: "BeaverNutrientAnalysis"
format: html
editor: visual
---

# Beaver Dam Nutrient Analysis

**Purpose** The purpose of this code is to examine patterns in nutrients (NOx, PO4 and NH4), temperature, and specific conductivity above and below beaver dams in Dry Creek Experimental Watershed, Boise, ID.

**Output** The output of this code is two box and whisker figures. The first groups samples by above and below a beaver dam at two separate sites, a lower and upper dam. One plot analyzes each sample day separately, while the other combines values measured across all days.

**To do:** add comments, maybe pseudocode, explanation at top of what code does and how, any assumptions made.

## Load Libraries 

```{r}
#| warning: false
library(ggplot2)
library(readxl)
library(dplyr)
library(cowplot)
```

## Bring in data

```{r}
setwd("/Users/hannahrichardson/Documents/BSU/Spring '23/Field Methods/FieldMethodsHydro")
list.files()
df <- read.csv("Quality Beaver Meadows Data Template.csv")
```

## Week 1

Pulls out data from Week 1 of analysis and builds box and whisker plots

```{r}
#Set date
date<- "2/24/23"
#Above and below pool
NOx <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NOx_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab('NOx (mg/L)')+
  ggtitle('Week 1')+
  theme(plot.title = element_text(hjust = 0.5))+
  theme_bw()

PO4 <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = PO4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab('PO4 (mg/L)')+
  theme_bw()

NH4 <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NH4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab('NH4 (mg/L)')+
  theme_bw()

temp <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = Temp._C, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  xlab('Site Type')+
  ylab('Temp C')+
  theme_bw()

EC <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = EC, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab('Site Type')+
  ylab('EC (uS/cm)')+
  theme_bw()

Wk1<-plot_grid(NOx, PO4, NH4, temp, EC, 
                nrow =5)

```

## Week 2

Pulls out data from Week 2 of analysis and builds box and whisker plots

```{r}
#set date
date<- "3/3/23"
#Above and below pool
NOx <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NOx_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab(NULL)+
  ggtitle('Week 2')+
  theme(plot.title = element_text(hjust = 0.5))+
  theme_bw()

PO4 <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = PO4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab(NULL)+
  theme_bw()

NH4 <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NH4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab(NULL)+
  theme_bw()

temp <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = Temp._C, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab(NULL)+
  theme_bw()

EC <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = EC, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab('Site Type')+
  ylab(NULL)+
  theme_bw()

Wk2<-plot_grid(NOx, PO4, NH4, temp, EC, 
                nrow =5)

```

## Week 3

Pulls out data from Week 3 of analysis and builds box and whisker plots

```{r}
#set date
date<- "3/10/23"
#Above and below pool
NOx <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NOx_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab(NULL)+
  ggtitle('Week 3')+
  theme(plot.title = element_text(hjust = 0.5))+
  theme_bw()

PO4 <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = PO4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
ylab(NULL)+
  theme_bw()

NH4 <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NH4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab(NULL)+
  theme_bw()

temp <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = Temp._C, fill= Site_Location))+
  geom_boxplot()+
  xlab(NULL)+
ylab(NULL)+
  theme_bw()+
    theme(legend.position = c(0.35, 0.7),
        legend.background = element_rect( fill = alpha("white", 0)))+
  labs(fill = "Site Location")

EC <- df %>%
  filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = EC, fill= Site_Location))+
  geom_boxplot(show.legend=FALSE)+
  xlab('Site Type')+
  ylab(NULL)+
  theme_bw()

Wk3<-plot_grid(NOx, PO4, NH4, temp, EC, 
                nrow =5)
```

### Combine weekly plots

Combine box and whisker plots into one figure

```{r}
allplot<-plot_grid(Wk1,Wk2,Wk3,
                   ncol= 3)

```

## Average weeks

```{r}
#Above and below pool
NOx <- df %>%
  #filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NOx_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab('NOx (mg/L)')+
  theme_bw()

PO4 <- df %>%
  #filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = PO4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab('PO4 (mg/L)')+
  theme_bw()

NH4 <- df %>%
  #filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = NH4_mgL, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab(NULL)+
  ylab('NH4 (mg/L)')+
  theme_bw()

temp <- df %>%
  #filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = Temp._C, fill= Site_Location))+
  geom_boxplot()+
  xlab(NULL)+
  ylab('Temp C')+
  theme_bw()+
      theme(legend.position = c(0.15, 0.7),
      legend.background = element_rect( fill = alpha("white", 0)))+
  labs(fill = "Site Location")

EC <- df %>%
 # filter(Date == date)%>%
  ggplot(aes(x = Site_type, y = EC, fill= Site_Location))+
  geom_boxplot(show.legend = FALSE)+
  xlab('Site Type')+
  ylab('EC (uS/cm)')+
  theme_bw()

Combo<-plot_grid(NOx, PO4, NH4, temp, EC, 
                nrow =5)
```

## Save pdfs

```{r}
pdf(file = "Allplots.pdf",
    width = 6,
    height = 10)

allplot
dev.off()

pdf(file = "Weekscombined.pdf",
    width = 4,
    height = 10)

Combo
dev.off()
```

Kendra notes

Naming convention: Project first (for folders)-\> name script based on what it's doing. Can separate code into separate chunks as different scripts, I.e. "upload data", "clean data", "make model", etc.
